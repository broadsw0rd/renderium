!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Renderium=i()}(this,function(){"use strict";function t(t,i){return i={exports:{}},t(i,i.exports),i.exports}var i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=t(function(t,e){!function(i,n){"object"==typeof e&&"undefined"!=typeof t?t.exports=n():"function"==typeof define&&define.amd?define(n):i.Vector=n()}(i,function(){function t(t,i){this.x=t||0,this.y=i||0}function i(t){this.vector=t,this.__idx=0}return t.displayName="Vector",t.from=function(i){return new t(i[0],i[1])},t.fromAngle=function(i,e){return new t(e*Math.cos(i),e*Math.sin(i))},t.parse=function(i){return t.from(i.trim().replace(","," ").split(/\s+/).map(parseFloat))},t.add=function(t,i){return i.add(t)},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y)},t.iadd=function(t,i){return i.iadd(t)},t.prototype.iadd=function(t){return this.x+=t.x,this.y+=t.y,this},t.sub=function(t,i){return i.sub(t)},t.prototype.sub=function(i){return new t(this.x-i.x,this.y-i.y)},t.isub=function(t,i){return i.isub(t)},t.prototype.isub=function(t){return this.x-=t.x,this.y-=t.y,this},t.mul=function(t,i){return i.mul(t)},t.prototype.mul=function(i){return new t(this.x*i,this.y*i)},t.imul=function(t,i){return i.imul(t)},t.prototype.imul=function(t){return this.x*=t,this.y*=t,this},t.div=function(t,i){return i.div(t)},t.prototype.div=function(i){return new t(this.x/i,this.y/i)},t.idiv=function(t,i){return i.idiv(t)},t.prototype.idiv=function(t){return this.x/=t,this.y/=t,this},t.lerp=function(t,i,e){return t.lerp(i,e)},t.prototype.lerp=function(i,e){var n=(1-e)*this.x+e*i.x,o=(1-e)*this.y+e*i.y;return new t(n,o)},t.normalized=function(t){return t.normalized()},t.prototype.normalized=function(){var i=this.x,e=this.y,n=Math.sqrt(i*i+e*e);return n>0?new t(i/n,e/n):new t(0,0)},t.normalize=function(t){return t.normalize()},t.prototype.normalize=function(){var t=this.x,i=this.y,e=Math.sqrt(t*t+i*i);return e>0&&(this.x=t/e,this.y=i/e),this},t.magnitude=function(t){return t.magnitude()},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.dot=function(t,i){return i.dot(t)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.distance=function(t,i){return i.distance(t)},t.prototype.distance=function(t){var i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)},t.angleOf=function(t){return t.angleOf()},t.prototype.angleOf=function(){return Math.atan2(this.y,this.x)},t.angleTo=function(t,i){return i.angleTo(t)},t.prototype.angleTo=function(t){return Math.acos(this.dot(t)/this.magnitude()*t.magnitude())},t.reset=function(t,i){return i.reset(t)},t.prototype.reset=function(t){return this.x=t.x,this.y=t.y,this},t.zero=function(t){return t.zero()},t.prototype.zero=function(){return this.x=0,this.y=0,this},t.set=function(t,i,e){return e.set(t,i)},t.prototype.set=function(t,i){return this.x=t||0,this.y=i||0,this},t.copy=function(t){return t.copy()},t.prototype.copy=function(){return new t(this.x,this.y)},t.toJSON=function(t){return t.toJSON()},t.prototype.toJSON=function(){return[this.x,this.y]},t.toString=function(t){return t?t.toString():Function.prototype.toString.call(this)},t.prototype.toString=function(){return this.x.toFixed(3)+" "+this.y.toFixed(3)},"undefined"!=typeof Symbol&&Symbol.toStringTag&&(t.prototype[Symbol.toStringTag]="Vector"),t.toArray=function(t){return t.toArray()},t.prototype.toArray=function(){return[this.x,this.y]},t.equals=function(t,i){return t.equals(i)},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.compare=function(t,i){return t.compare(i)},t.prototype.compare=function(t){var i=this.magnitude(),e=t.magnitude();return(i>e)-(e>i)},Object.defineProperties(t.prototype,{xx:{configurable:!0,get:function(){return new t(this.x,this.x)},set:function(t){this.x=t.x,this.y=t.x}},xy:{configurable:!0,get:function(){return new t(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},yx:{configurable:!0,get:function(){return new t(this.y,this.x)},set:function(t){this.x=t.y,this.y=t.x}},yy:{configurable:!0,get:function(){return new t(this.y,this.y)},set:function(t){this.x=t.y,this.y=t.y}}}),i.prototype.next=function(){return 0===this.__idx?(this.__idx++,{done:!1,value:this.vector.x}):1===this.__idx?(this.__idx++,{done:!1,value:this.vector.y}):{done:!0,value:void 0}},"undefined"!=typeof Symbol&&Symbol.iterator&&(t.prototype[Symbol.iterator]=function(){return new i(this)}),t})}),n=(function(){function t(t){this.value=t}function i(i){function e(t,i){return new Promise(function(e,o){var h={key:t,arg:i,resolve:e,reject:o,next:null};s?s=s.next=h:(r=s=h,n(t,i))})}function n(e,r){try{var s=i[e](r),h=s.value;h instanceof t?Promise.resolve(h.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(s.done?"return":"normal",s.value)}catch(t){o("throw",t)}}function o(t,i){switch(t){case"return":r.resolve({value:i,done:!0});break;case"throw":r.reject(i);break;default:r.resolve({value:i,done:!1})}r=r.next,r?n(r.key,r.arg):s=null}var r,s;this._invoke=e,"function"!=typeof i.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(t){return this._invoke("next",t)},i.prototype.throw=function(t){return this._invoke("throw",t)},i.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new i(t.apply(this,arguments))}},await:function(i){return new t(i)}}}(),function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}),o={},r={},s=function(){function t(){n(this,t)}return t.prototype.onload=function(){},t.prototype.getImage=function(t){return r[t]},t.prototype.getStatus=function(t){return o[t]},t.prototype.load=function(i){var e=this.getStatus(i),n=this;if(e!==t.IMAGE_STATUS_LOADING&&e!==t.IMAGE_STATUS_LOADED){o[i]=t.IMAGE_STATUS_LOADING;var s=new window.Image;s.onload=function(){o[i]=t.IMAGE_STATUS_LOADED,r[i]=this,n.onload()},s.src=i}},t}();s.IMAGE_STATUS_LOADING=1,s.IMAGE_STATUS_LOADED=2;var h=window.devicePixelRatio||1,a=function(){function t(i){var e=i.start,o=i.end,r=i.from,s=i.to;n(this,t),this.start=e,this.end=o,this.from=r,this.to=s,this._isGradient=!0,this._gradient=null}return t.isGradient=function(t){return t&&t._isGradient},t.prototype.createGradient=function(t){return this._gradient=t.ctx.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y),this._gradient.addColorStop(0,this.from),this._gradient.addColorStop(1,this.to),this._gradient},t.prototype.valueOf=function(){return this._gradient},t}(),c=function(){function t(i){var e=i.antialiasing,o=i.width,r=i.height;n(this,t),this.antialiasing=Boolean(e),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.scale({width:o||t.DEFAULT_WIDTH,height:r||t.DEFAULT_HEIGHT}),this.imageLoader=new s,this.imageLoader.onload=this.forceRedraw.bind(this),this.components=[],this._shouldRedraw=!1}return t.prototype.scale=function(i){var e=i.width,n=i.height;this.width=e||t.DEFAULT_WIDTH,this.height=n||t.DEFAULT_HEIGHT,this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this.canvas.removeAttribute("style"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.ctx.canvas.style.width=this.width+"px",this.ctx.canvas.style.height=this.height+"px",window.devicePixelRatio&&(this.ctx.canvas.width=this.width*h,this.ctx.canvas.height=this.height*h,this.ctx.scale(h,h)),this.antialiasing||this.ctx.translate(.5,.5),this.forceRedraw()},t.prototype.clear=function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},t.prototype.redraw=function(){for(var t=0;t<this.components.length;t++){var i=this.components[t];i.plot(this),i.draw(this)}this._shouldRedraw=!1},t.prototype.forceRedraw=function(){this._shouldRedraw=!0},t.prototype.shouldRedraw=function(){for(var t=0;t<this.components.length;t++){var i=this.components[t];if(i.shouldRedraw())return!0}return this._shouldRedraw},t.prototype.addComponent=function(t){this.components.push(t)},t.prototype.removeComponent=function(t){var i=this.components.indexOf(t);i!==-1&&this.components.splice(i,1)},t.prototype.createGradient=function(t){var i=t.start,e=t.end,n=t.from,o=t.to;return new a({start:i,end:e,from:n,to:o})},t.prototype.getColor=function(t){return a.isGradient(t)?t.createGradient(this):t},t.prototype.drawArc=function(t){var i=t.position,e=t.radius,n=t.startAngle,o=t.endAngle,r=t.color,s=t.width,h=void 0===s?1:s;this.ctx.strokeStyle=this.getColor(r),this.ctx.lineWidth=h,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e,n,o),r&&this.ctx.stroke()},t.prototype.drawCircle=function(t){var i=t.position,e=t.radius,n=t.color,o=t.fillColor,r=t.width,s=void 0===r?1:r;this.drawArc({position:i,radius:e,startAngle:0,endAngle:2*Math.PI,color:n,width:s}),o&&(this.ctx.fillStyle=this.getColor(o),this.ctx.fill())},t.prototype.drawImage=function(t){var i=t.position,e=t.image,n=t.width,o=void 0===n?e.width:n,r=t.height,h=void 0===r?e.height:r,a=t.opacity,c=void 0===a?1:a;if("string"==typeof e){if(this.imageLoader.getStatus(e)!==s.IMAGE_STATUS_LOADED)return this.imageLoader.getStatus(e)!==s.IMAGE_STATUS_LOADING?void this.imageLoader.load(e):void 0;e=this.imageLoader.getImage(e),o=o||e.width,h=h||e.height}var u=this.ctx.globalAlpha;this.ctx.globalAlpha=c,this.ctx.drawImage(e,i.x-o/2,i.y-h/2,o,h),this.ctx.globalAlpha=u},t.prototype.drawPolygon=function(t){var i=t.points,e=t.color,n=t.fillColor,o=t.width,r=void 0===o?1:o;this.drawPolyline({points:i.concat(i[0]),color:e,width:r}),n&&(this.ctx.fillStyle=this.getColor(n),this.ctx.fill())},t.prototype.drawPolyline=function(t){var i=t.points,e=t.color,n=t.lineDash,o=void 0===n?[]:n,r=t.width,s=void 0===r?1:r;this.ctx.lineWidth=s,this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(i[0].x,i[0].y);for(var h,a=1;a<i.length;a++)h=i[a],this.ctx.lineTo(h.x,h.y);this.ctx.setLineDash(o),i[0].equals(i[i.length-1])&&this.ctx.closePath(),e&&(this.ctx.strokeStyle=this.getColor(e),this.ctx.stroke())},t.prototype.drawRect=function(t){var i=t.position,n=t.width,o=t.height,r=t.color,s=t.fillColor,h=t.strokeWidth,a=void 0===h?1:h;this.drawPolygon({points:[new e(i.x-n/2,i.y+o/2),new e(i.x+n/2,i.y+o/2),new e(i.x+n/2,i.y-o/2),new e(i.x-n/2,i.y-o/2)],color:r,fillColor:s,width:a})},t.prototype.drawText=function(t){var i=t.position,e=t.text,n=t.color,o=t.font,r=t.size,s=t.align,h=void 0===s?"center":s,a=t.baseline,c=void 0===a?"middle":a;this.ctx.fillStyle=this.getColor(n),this.ctx.font=r+"px "+o,this.ctx.textAlign=h,this.ctx.textBaseline=c,this.ctx.fillText(e,i.x,i.y)},t.prototype.measureText=function(t){var i,e=t.text,n=t.font,o=t.size;if(n&&o){var r=this.ctx.font;this.ctx.font=o+"px "+n,i=this.ctx.measureText(e).width,this.ctx.font=r}else i=this.ctx.measureText(e).width;return i},t}();c.DEFAULT_WIDTH=100,c.DEFAULT_HEIGHT=100;var u={RED:"#f44336",PINK:"#e91e63",PURPLE:"#9c27b0",DEEP_PURPLE:"#673ab7",INDIGO:"#3f51b5",BLUE:"#2196f3",LIGHT_BLUE:"#03a9f4",CYAN:"#00bcd4",TEAL:"#009688",GREEN:"#4caf50",LIGHT_GREEN:"#8bc34a",LIME:"#cddc39",YELLOW:"#ffeb3b",AMBER:"#ffc107",ORANGE:"#ff9800",DEEP_ORANGE:"#ff5722",BROWN:"#795548",GREY:"#9e9e9e",BLUE_GREY:"#607d8b"},f=function(){function t(i){var e=i.el;n(this,t),this.el=e,this.width=this.el.clientWidth,this.height=this.el.clientHeight,this.layers=[]}return t.spawn=function(i){t.instances.push(i)},t.kill=function(i){var e=t.instances.indexOf(i);e!==-1&&t.instances.splice(e,1)},t.digest=function(){for(var i=0;i<t.instances.length;i++){var e=t.instances[i];e.clear(),e.scale(),e.redraw()}},t.prototype.addLayer=function(t){this.layers.push(t),this.el.appendChild(t.canvas),t.scale({width:this.width,height:this.height})},t.prototype.removeLayer=function(t){var i=this.layers.indexOf(t);i!==-1&&(this.layers.splice(i,1),this.el.removeChild(t.canvas))},t.prototype.scale=function(){var t=this.el.clientWidth,i=this.el.clientHeight;if(t!==this.width||i!==this.height){for(var e=0;e<this.layers.length;e++){var n=this.layers[e];n.scale({width:t,height:i})}this.width=t,this.height=i}},t.prototype.clear=function(){for(var t=0;t<this.layers.length;t++){var i=this.layers[t];i.shouldRedraw()&&i.clear()}},t.prototype.redraw=function(){for(var t=0;t<this.layers.length;t++){var i=this.layers[t];i.shouldRedraw()&&i.redraw()}},t}();return f.instances=[],f.CanvasLayer=c,f.Vector=e,f.colors=u,f});
