!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Renderium=e()}(this,function(){"use strict";function t(t){throw new Error("\r\nRenderium: "+t)}function e(t){var e=t.getContext("webgl2");return e||(e=t.getContext("webgl")).getExtension("OES_element_index_uint"),e}function i(e,i,o){var r=e.createShader(o);return e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||t("Could not compile shader:\r\n"+e.getShaderInfoLog(r)),r}function o(e,i,o){var r=e.createProgram();return e.attachShader(r,i),e.attachShader(r,o),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||t("Program failed to link:\r\n"+e.getProgramInfoLog(r)),r}function r(t){return null==t||"function"!=typeof t&&"object"!=typeof t}function s(t,e,i,o){var s=r(o)?o:i(o);if(!e.has(s)){var n=t.call(this,o);return e.set(s,n),n}return e.get(s)}function n(t,e,i){var o=Array.prototype.slice.call(arguments,3),r=i(o);if(!e.has(r)){var s=t.apply(this,o);return e.set(r,s),s}return e.get(r)}function h(t,e,i,o,r){return i.bind(e,t,o,r)}function a(t,e){return h(t,this,1===t.length?s:n,e.cache.create(),e.serializer)}function c(){return JSON.stringify(arguments)}function l(){this.cache=Object.create(null)}function p(t){return[(t=parseInt(t.slice(1),16))>>16&255,t>>8&255,255&t,1]}function u(t){return t=t.match(/\d+\.?\d*/g),[Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])]}var d={},f={},g=function(){};g.prototype.onload=function(){},g.prototype.getImage=function(t){return f[t]},g.prototype.getStatus=function(t){return d[t]},g.prototype.load=function(t){var e=this,i=this.getStatus(t);if(i!==g.IMAGE_STATUS_LOADING&&i!==g.IMAGE_STATUS_LOADED){d[t]=g.IMAGE_STATUS_LOADING;var o=new window.Image;o.onload=function(){d[t]=g.IMAGE_STATUS_LOADED,f[t]=o,e.onload()},o.src=t}},g.prototype.IMAGE_STATUS_LOADING=g.IMAGE_STATUS_LOADING=1,g.prototype.IMAGE_STATUS_LOADED=g.IMAGE_STATUS_LOADED=2;var y=function(t){void 0===t&&(t={}),this.tasks=t};y.prototype.plan=function(t){this.tasks[t]=!0},y.prototype.complete=function(t){this.tasks[t]=!1},y.prototype.should=function(t){return Boolean(this.tasks[t])};var v=function(){};v.isComponent=function(t){return"function"==typeof t.plot&&"function"==typeof t.draw&&"function"==typeof t.shouldRedraw&&"function"==typeof t.onadd&&"function"==typeof t.onremove},v.prototype.onadd=function(t){},v.prototype.onremove=function(t){},v.prototype.plot=function(t){},v.prototype.draw=function(t){},v.prototype.shouldRedraw=function(){return!0};var _=function t(e){var i=e.Vector,o=e.logger,r=e.verbose,s=e.width,n=e.height;this.Vector=i||window.Vector,this.logger=o,this.verbose=Boolean(r),this.width=Number(s)||t.DEFAULT_WIDTH,this.height=Number(n)||t.DEFAULT_HEIGHT,this.canvas=document.createElement("canvas"),this.imageLoader=new g,this.scheduler=new y({redraw:!1,drawComponents:!1}),this.components=[],this.stats={}};_.prototype.scale=function(e){var i=e.width,o=e.height;this.shouldDrawComponents()&&t("Layer#scale() is forbidden during render cycle"),this.width=Number(i)||_.DEFAULT_WIDTH,this.height=Number(o)||_.DEFAULT_HEIGHT,this.canvas.width=this.width,this.canvas.height=this.height,window.devicePixelRatio&&(this.canvas.width=this.width*_.PIXEL_RATIO,this.canvas.height=this.height*_.PIXEL_RATIO),this.applyStyles(),this.planRedraw(),this.log("width",this.width),this.log("height",this.height)},_.prototype.applyStyles=function(){this.shouldDrawComponents()&&t("Layer#applyStyles() is forbidden during render cycle"),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.canvas.style.right=0,this.canvas.style.bottom=0},_.prototype.clear=function(){this.shouldDrawComponents()&&t("Layer#clear() is forbidden during render cycle"),this.clearStats()},_.prototype.redraw=function(e,i){var o=this;this.shouldDrawComponents()&&t("Layer#redraw() is forbidden during render cycle"),this.log("components",this.components.length),this.log("delta",i),this.log("fps",1e3/i|0),this.planDrawComponents();for(var r=0;r<this.components.length;r++){var s=o.components[r];(s.shouldRedraw()||o.scheduler.should("redraw"))&&s.plot(o,e,i),s.draw(o,e,i)}this.completeDrawComponents(),this.completeRedraw()},_.prototype.forceRedraw=function(){this.planRedraw()},_.prototype.planRedraw=function(){this.scheduler.plan("redraw")},_.prototype.completeRedraw=function(){this.scheduler.complete("redraw")},_.prototype.shouldRedraw=function(){for(var t=this,e=0;e<this.components.length;e++)if(t.components[e].shouldRedraw())return!0;return this.scheduler.should("redraw")},_.prototype.planDrawComponents=function(){this.scheduler.plan("drawComponents")},_.prototype.completeDrawComponents=function(){this.scheduler.complete("drawComponents")},_.prototype.shouldDrawComponents=function(){return this.scheduler.should("drawComponents")},_.prototype.addComponent=function(e){this.shouldDrawComponents()&&t("Layer#addComponent() is forbidden during render cycle"),-1!==this.components.indexOf(e)&&t("Component "+e.constructor.name+" has already been added to layer"),v.isComponent(e)||t("Component "+e.constructor.name+" has not implemented Component interface"),this.components.push(e),this.planRedraw(),e.onadd(this)},_.prototype.addComponents=function(t){t.forEach(this.addComponent,this)},_.prototype.removeComponent=function(e){this.shouldDrawComponents()&&t("Layer#removeComponent() is forbidden during render cycle");var i=this.components.indexOf(e);-1!==i&&(this.components.splice(i,1),this.planRedraw()),e.onremove(this)},_.prototype.removeComponents=function(t){t.forEach(this.removeComponent,this)},_.prototype.clearComponents=function(){this.shouldDrawComponents()&&t("Layer#clearComponents() is forbidden during render cycle"),this.components=[],this.planRedraw()},_.prototype.clearStats=function(){var e=this;this.shouldDrawComponents()&&t("Layer#clearStats() is forbidden during render cycle");for(var i in e.stats)e.stats[i]=0},_.prototype.collectStats=function(t){this.stats[t]=1+(0|this.stats[t])},_.prototype.log=function(t,e){this.verbose&&this.logger&&this.logger.log(t,e)},_.prototype.printStats=function(){var t=this;if(this.verbose)for(var e in t.stats)t.log(e,t.stats[e])},_.PIXEL_RATIO=window.devicePixelRatio||1,_.DEFAULT_WIDTH=100,_.DEFAULT_HEIGHT=100;var E=function(t,e){var i=t.length;if(i!==e.length)return!1;for(var o=0;o<i;o++)if(t[o]!==e[o])return!1;return!0},m=function(t){function e(e){var i=e.Vector,o=e.logger,r=e.verbose,s=e.antialiasing,n=e.width,h=e.height;t.call(this,{Vector:i,logger:o,verbose:r,width:n,height:h}),this.antialiasing=Boolean(s),this.ctx=this.canvas.getContext("2d"),this.scale({width:n,height:h}),this.imageLoader.onload=this.planRedraw.bind(this),this.scheduler.complete("stroke"),this.scheduler.complete("fill")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.scale=function(e){var i=e.width,o=e.height;t.prototype.scale.call(this,{width:i,height:o}),window.devicePixelRatio&&this.ctx.scale(t.PIXEL_RATIO,t.PIXEL_RATIO),this.antialiasing||this.ctx.translate(.5,.5)},e.prototype.clear=function(){t.prototype.clear.call(this),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},e.prototype.redraw=function(e){t.prototype.redraw.call(this,e),this.performDraw(),this.printStats()},e.prototype.stateChanged=function(t){var e=t.color,i=t.fillColor,o=t.width,r=t.lineDash,s=t.opacity;return e&&e!==this.ctx.strokeStyle||i&&i!==this.ctx.fillStyle||o&&o!==this.ctx.lineWidth||s&&s!==this.ctx.globalAlpha||r&&!E(r,this.ctx.getLineDash())},e.prototype.performDraw=function(){this.scheduler.should("stroke")&&(this.collectStats("stroke"),this.ctx.stroke(),this.scheduler.complete("stroke")),this.scheduler.should("fill")&&(this.collectStats("fill"),this.ctx.fill(),this.scheduler.complete("fill")),this.ctx.beginPath()},e.prototype.createGradient=function(t){var e=t.start,i=t.end,o=t.from,r=t.to;this.collectStats("gradient");var s=this.ctx.createLinearGradient(e.x,e.y,i.x,i.y);return s.addColorStop(0,o),s.addColorStop(1,r),s},e.prototype.drawArc=function(t){var e=t.position,i=t.radius,o=t.startAngle,r=t.endAngle,s=t.color,n=t.width;void 0===n&&(n=1);var h=t.opacity;void 0===h&&(h=1);var a=t.lineDash;void 0===a&&(a=[]),this.collectStats("arc"),this.performDraw(),this.ctx.arc(e.x,e.y,i,o,r),s&&(this.ctx.strokeStyle=s,this.ctx.lineWidth=n,this.ctx.globalAlpha=h,this.ctx.setLineDash(a),this.scheduler.plan("stroke"))},e.prototype.drawCircle=function(t){var e=t.position,i=t.radius,o=t.color,r=t.fillColor,s=t.width;void 0===s&&(s=1);var n=t.opacity;void 0===n&&(n=1);var h=t.lineDash;void 0===h&&(h=[]),this.collectStats("circle"),this.stateChanged({color:o,fillColor:r,width:s,opacity:n,lineDash:h})&&this.performDraw(),this.drawArc({position:e,radius:i,startAngle:0,endAngle:2*Math.PI,color:o,width:s,opacity:n,lineDash:h}),r&&(this.ctx.fillStyle=r,this.ctx.globalAlpha=n,this.scheduler.plan("fill"))},e.prototype.drawImage=function(t){var e=t.position,i=t.image,o=t.width;void 0===o&&(o=i.width);var r=t.height;void 0===r&&(r=i.height);var s=t.opacity;if(void 0===s&&(s=1),this.collectStats("image"),this.performDraw(),"string"==typeof i){if(this.imageLoader.getStatus(i)!==this.imageLoader.IMAGE_STATUS_LOADED)return this.imageLoader.getStatus(i)!==this.imageLoader.IMAGE_STATUS_LOADING?void this.imageLoader.load(i):void 0;i=this.imageLoader.getImage(i),o=o||i.width,r=r||i.height}this.ctx.globalAlpha=s,this.antialiasing?this.ctx.drawImage(i,e.x,e.y,o,r):this.ctx.drawImage(i,e.x-.5,e.y-.5,o,r)},e.prototype.drawPolygon=function(t){var e=t.points,i=t.color,o=t.fillColor,r=t.width;void 0===r&&(r=1);var s=t.opacity;void 0===s&&(s=1);var n=t.lineDash;void 0===n&&(n=[]),this.collectStats("polygon"),this.stateChanged({color:i,fillColor:o,width:r,opacity:s,lineDash:n})&&this.performDraw(),this.drawPolyline({points:e.concat(e[0]),color:i,width:r,opacity:s,lineDash:n}),o&&(this.ctx.fillStyle=o,this.ctx.globalAlpha=s,this.scheduler.plan("fill"))},e.prototype.drawPolyline=function(t){var e=this,i=t.points,o=t.color,r=t.width;void 0===r&&(r=1);var s=t.opacity;void 0===s&&(s=1);var n=t.lineDash;void 0===n&&(n=[]),this.collectStats("polyline"),this.stateChanged({color:o,width:r,opacity:s,lineDash:n})&&this.performDraw(),this.ctx.moveTo(i[0].x,i[0].y);for(var h,a=1;a<i.length;a++)h=i[a],e.ctx.lineTo(h.x,h.y);i[0].equals(i[i.length-1])&&this.ctx.closePath(),o&&(this.ctx.strokeStyle=o,this.ctx.lineWidth=r,this.ctx.globalAlpha=s,this.ctx.setLineDash(n),this.scheduler.plan("stroke"))},e.prototype.drawRect=function(t){var e=t.position,i=t.width,o=t.height,r=t.color,s=t.fillColor,n=t.strokeWidth;void 0===n&&(n=1);var h=t.opacity;void 0===h&&(h=1);var a=t.lineDash;void 0===a&&(a=[]),this.collectStats("rect"),this.stateChanged({color:r,fillColor:s,width:n,opacity:h,lineDash:a})&&this.performDraw(),this.antialiasing?this.ctx.rect(e.x,e.y,i,o):this.ctx.rect(e.x-.5,e.y-.5,i,o),r&&(this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.globalAlpha=h,this.ctx.setLineDash(a),this.scheduler.plan("stroke")),s&&(this.ctx.globalAlpha=h,this.ctx.fillStyle=s,this.scheduler.plan("fill"))},e.prototype.drawText=function(t){var e=t.position,i=t.text,o=t.color,r=t.font,s=t.size,n=t.align;void 0===n&&(n="center");var h=t.baseline;void 0===h&&(h="middle");var a=t.opacity;void 0===a&&(a=1),this.collectStats("text"),this.performDraw(),this.ctx.fillStyle=o,this.ctx.font=s+"px "+r,this.ctx.textAlign=n,this.ctx.textBaseline=h,this.ctx.globalAlpha=a,this.ctx.fillText(i,e.x,e.y)},e.prototype.measureText=function(t){var e,i=t.text,o=t.font,r=t.size;if(o&&r){var s=this.ctx.font;this.ctx.font=r+"px "+o,e=this.ctx.measureText(i).width,this.ctx.font=s}else e=this.ctx.measureText(i).width;return e},e}(_);l.prototype.has=function(t){return t in this.cache},l.prototype.get=function(t){return this.cache[t]},l.prototype.set=function(t,e){this.cache[t]=e};var S={create:function(){return new l}},w=function(t,e){var i=e&&e.cache?e.cache:S,o=e&&e.serializer?e.serializer:c;return(e&&e.strategy?e.strategy:a)(t,{cache:i,serializer:o})},A={variadic:function(t,e){return h(t,this,n,e.cache.create(),e.serializer)},monadic:function(t,e){return h(t,this,s,e.cache.create(),e.serializer)}};w.strategies=A;var T=w(function(e){var i;return"#"===e[0]?i=p(e):"r"===e[0]?i=u(e):t("Wrong color format: "+e),i}),L="uniform vec2 u_resolution;\r\n\r\nattribute vec2 a_position;\r\nattribute vec3 a_color;\r\nattribute float a_alpha;\r\n\r\nvarying vec4 v_color;\r\n\r\nconst vec2 unit = vec2(1, -1);\r\n\r\nvec4 convertPoints (vec2 position, vec2 resolution) {\r\n  return vec4((position / resolution * 2.0 - 1.0) * unit, 0, 1);\r\n}\r\n\r\nvoid main () {\r\n  gl_Position = convertPoints(a_position, u_resolution);\r\n  v_color = vec4(a_color, a_alpha);\r\n}\r\n",I="precision mediump float;\r\n\r\nvarying vec4 v_color;\r\n\r\nvoid main() {\r\n  gl_FragColor = v_color;\r\n}\r\n",x=function(t){this.offset=0,this.alloc(t,[])};x.prototype.alloc=function(t,e){void 0===e&&(e=[]),this.size=t,this.array=new Uint8Array(t),this.buffer=this.array.buffer,this.array.set(e)},x.prototype.clear=function(){this.offset=0},x.prototype.toArray=function(){return this.array.subarray(0,this.offset)},x.prototype.pushByte=function(t){this.array[this.offset]=t,this.offset+=1},x.prototype.pushShort=function(t){var e=255&t,i=(t-e)/256;this.pushByte(e),this.pushByte(i)},x.prototype.pushUShort=function(t){var e=255&t,i=t>>8&255;this.pushByte(e),this.pushByte(i)},x.prototype.pushUInt=function(t){var e=255&t,i=t>>8&255,o=t>>16&255,r=t>>24&255;this.pushByte(e),this.pushByte(i),this.pushByte(o),this.pushByte(r)};var R=function(t){function e(e,i){t.call(this,e),this.gl=i,this.componentSize=this.getComponentSize(),this.bufferData()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getComponentSize=function(){return Uint32Array.BYTES_PER_ELEMENT},e.prototype.bufferData=function(){this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer,this.gl.DYNAMIC_DRAW)},e.prototype.shouldAlloc=function(){return this.offset+this.componentSize>this.size},e.prototype.push=function(t){this.shouldAlloc()&&(this.alloc(2*this.size,this.array),this.bufferData()),this.pushUInt(t)},e}(x),C=function(t){function e(e,i){t.call(this,e),this.gl=i,this.componentSize=this.getComponentSize(),this.bufferData()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getComponentSize=function(){return 2*Int16Array.BYTES_PER_ELEMENT+4*Uint8Array.BYTES_PER_ELEMENT},e.prototype.bufferData=function(){this.gl.bufferData(this.gl.ARRAY_BUFFER,this.buffer,this.gl.DYNAMIC_DRAW)},e.prototype.shouldAlloc=function(){return this.offset+this.componentSize>this.size},e.prototype.push=function(t,e,i,o,r,s){this.shouldAlloc()&&(this.alloc(2*this.size,this.array),this.bufferData()),this.pushShort(t),this.pushShort(e),this.pushByte(i),this.pushByte(o),this.pushByte(r),this.pushByte(s)},e}(x),D=function(t){function r(r){var s=r.Vector,n=r.logger,h=r.verbose,a=r.width,c=r.height;t.call(this,{Vector:s,logger:n,verbose:h,width:a,height:c}),this.gl=e(this.canvas),this.scale({width:a,height:c}),this.imageLoader.onload=this.forceRedraw.bind(this),this._vertexShader=i(this.gl,L,this.gl.VERTEX_SHADER),this._fragmentShader=i(this.gl,I,this.gl.FRAGMENT_SHADER),this._program=o(this.gl,this._vertexShader,this._fragmentShader),this.gl.useProgram(this._program),this._resolutionLocation=this.gl.getUniformLocation(this._program,"u_resolution"),this._positionLocation=this.gl.getAttribLocation(this._program,"a_position"),this._colorLocation=this.gl.getAttribLocation(this._program,"a_color"),this._alphaLocation=this.gl.getAttribLocation(this._program,"a_alpha"),this._indicesBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),this.indices=new R(this.DEFAULT_INDICES_COUNT,this.gl),this._verticesBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._verticesBuffer),this.vertices=new C(this.DEFAULT_VERTICES_COUNT,this.gl),this.verticesCount=0,this.gl.enableVertexAttribArray(this._positionLocation),this.gl.enableVertexAttribArray(this._colorLocation),this.gl.enableVertexAttribArray(this._alphaLocation),this.gl.vertexAttribPointer(this._positionLocation,this.POSITION_LENGTH,this.gl.SHORT,!1,this.ATTRIBUTES_SIZE,0),this.gl.vertexAttribPointer(this._colorLocation,this.COLOR_LENGTH,this.gl.UNSIGNED_BYTE,!0,this.ATTRIBUTES_SIZE,this.POSITION_SIZE),this.gl.vertexAttribPointer(this._alphaLocation,this.ALPHA_LENGTH,this.gl.UNSIGNED_BYTE,!0,this.ATTRIBUTES_SIZE,this.POSITION_SIZE+this.COLOR_SIZE),this.gl.enable(this.gl.BLEND),this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var s={POSITION_LENGTH:{},POSITION_SIZE:{},COLOR_LENGTH:{},COLOR_SIZE:{},ALPHA_LENGTH:{},ALPHA_SIZE:{},ATTRIBUTES_LENGTH:{},ATTRIBUTES_SIZE:{},DEFAULT_INDICES_COUNT:{},DEFAULT_VERTICES_COUNT:{}};return s.POSITION_LENGTH.get=function(){return 2},s.POSITION_SIZE.get=function(){return this.POSITION_LENGTH*Int16Array.BYTES_PER_ELEMENT},s.COLOR_LENGTH.get=function(){return 3},s.COLOR_SIZE.get=function(){return this.COLOR_LENGTH*Uint8Array.BYTES_PER_ELEMENT},s.ALPHA_LENGTH.get=function(){return 1},s.ALPHA_SIZE.get=function(){return this.ALPHA_LENGTH*Uint8Array.BYTES_PER_ELEMENT},s.ATTRIBUTES_LENGTH.get=function(){return this.POSITION_LENGTH+this.COLOR_LENGTH+this.ALPHA_LENGTH},s.ATTRIBUTES_SIZE.get=function(){return this.POSITION_SIZE+this.COLOR_SIZE+this.ALPHA_SIZE},s.DEFAULT_INDICES_COUNT.get=function(){return 255},s.DEFAULT_VERTICES_COUNT.get=function(){return this.DEFAULT_INDICES_COUNT*this.ATTRIBUTES_LENGTH},r.prototype.scale=function(e){var i=e.width,o=e.height;t.prototype.scale.call(this,{width:i,height:o}),this.gl.viewport(0,0,this.width*t.PIXEL_RATIO,this.height*t.PIXEL_RATIO),this.gl.uniform2f(this._resolutionLocation,this.width,this.height)},r.prototype.clear=function(){t.prototype.clear.call(this),this.verticesCount=0,this.indices.clear(),this.vertices.clear(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)},r.prototype.redraw=function(){t.prototype.redraw.call(this),this.gl.bufferSubData(this.gl.ELEMENT_ARRAY_BUFFER,0,this.indices.toArray()),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.vertices.toArray()),this.gl.drawElements(this.gl.TRIANGLE_STRIP,this.indices.offset/this.indices.componentSize,this.gl.UNSIGNED_INT,0),this.printStats(),this.log("vertices",this.verticesCount),this.log("memory",this.vertices.size)},r.prototype.createGradient=function(t){return{start:t.start,end:t.end,from:t.from,to:t.to}},r.prototype.getColor=function(t){return T(t)},r.prototype.drawArc=function(t){this.collectStats("arc")},r.prototype.drawCircle=function(t){this.collectStats("circle")},r.prototype.drawImage=function(t){var e=t.image;if(this.collectStats("image"),"string"==typeof e){if(this.imageLoader.getStatus(e)!==this.imageLoader.IMAGE_STATUS_LOADED)return this.imageLoader.getStatus(e)!==this.imageLoader.IMAGE_STATUS_LOADING?(this.imageLoader.load(e),1):1;e=this.imageLoader.getImage(e)}},r.prototype.drawPolygon=function(t){var e=t.points,i=t.color,o=t.width;void 0===o&&(o=1),this.collectStats("polygon"),this.drawPolyline({points:e.concat(e[0]),color:i,width:o})},r.prototype.drawPolyline=function(t){this.collectStats("polyline")},r.prototype.drawRect=function(t){var e=t.position,i=t.width,o=t.height,r=t.fillColor,s=t.opacity;void 0===s&&(s=1),this.collectStats("rect");var n=this.getColor(r),h=n[0],a=n[1],c=n[2],l=n[3];l=l*s*255|0;var p=this.verticesCount;this.indices.push(p),this.indices.push(p),this.indices.push(p+1),this.indices.push(p+2),this.indices.push(p+3),this.indices.push(p+3),this.vertices.push(e.x,e.y,h,a,c,l),this.vertices.push(e.x+i,e.y,h,a,c,l),this.vertices.push(e.x,e.y+o,h,a,c,l),this.vertices.push(e.x+i,e.y+o,h,a,c,l),this.verticesCount+=4},r.prototype.drawText=function(t){this.collectStats("text")},r.prototype.measureText=function(t){return 0},Object.defineProperties(r.prototype,s),r}(_),b=function(t){var e=t.start,i=t.end,o=t.from,r=t.to;this.start=e,this.end=i,this.from=o,this.to=r,this._isGradient=!0};b.isGradient=function(t){return t&&t._isGradient};var O={RED:"#f44336",PINK:"#e91e63",PURPLE:"#9c27b0",DEEP_PURPLE:"#673ab7",INDIGO:"#3f51b5",BLUE:"#2196f3",LIGHT_BLUE:"#03a9f4",CYAN:"#00bcd4",TEAL:"#009688",GREEN:"#4caf50",LIGHT_GREEN:"#8bc34a",LIME:"#cddc39",YELLOW:"#ffeb3b",AMBER:"#ffc107",ORANGE:"#ff9800",DEEP_ORANGE:"#ff5722",BROWN:"#795548",GREY:"#9e9e9e",BLUE_GREY:"#607d8b"},N=0,P=function(t){var e=t.el;this.el=e,this.applyStyles(),this.width=this.el.clientWidth,this.height=this.el.clientHeight,this.layers=[]};return P.spawn=function(e){-1!==P.instances.indexOf(e)&&t("Renderer has already been spawned"),P.instances.push(e)},P.kill=function(t){var e=P.instances.indexOf(t);-1!==e&&P.instances.splice(e,1)},P.digest=function(t){var e=t-N;N=t;for(var i=0;i<P.instances.length;i++){var o=P.instances[i];o.scale(),o.clear(),o.redraw(t,e)}},P.prototype.applyStyles=function(){this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%"},P.prototype.addLayer=function(e){-1!==this.layers.indexOf(e)&&t("Layer has already been added to renderer"),this.layers.push(e),this.el.appendChild(e.canvas),e.scale({width:this.width,height:this.height})},P.prototype.removeLayer=function(t){var e=this.layers.indexOf(t);-1!==e&&(this.layers.splice(e,1),this.el.removeChild(t.canvas))},P.prototype.scale=function(){var t=this,e=this.el.clientWidth,i=this.el.clientHeight;if(e!==this.width||i!==this.height){for(var o=0;o<this.layers.length;o++)t.layers[o].scale({width:e,height:i});this.width=e,this.height=i}},P.prototype.clear=function(){for(var t=this,e=0;e<this.layers.length;e++){var i=t.layers[e];i.shouldRedraw()&&i.clear()}},P.prototype.redraw=function(t){for(var e=this,i=0;i<this.layers.length;i++){var o=e.layers[i];o.shouldRedraw()&&o.redraw(t)}},P.instances=[],P.BaseLayer=_,P.CanvasLayer=m,P.WebglLayer=D,P.LinearGradient=b,P.Component=v,P.colors=O,P});
