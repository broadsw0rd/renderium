!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Renderium=i()}(this,function(){"use strict";function t(t,i,s){if(t+="",i-=t.length,i<=0)return t;if(s||0===s||(s=" "),s+=""," "===s&&i<10)return e[i]+t;for(var o="";;){if(1&i&&(o+=s),i>>=1,!i)break;s+=s}return o+t}var i=t,e=[""," ","  ","   ","    ","     ","      ","       ","        ","         "],s=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},o={},r={},a=function(){function t(){s(this,t)}return t.prototype.onload=function(){},t.prototype.getImage=function(t){return r[t]},t.prototype.getStatus=function(t){return o[t]},t.prototype.load=function(i){var e=this.getStatus(i),s=this;if(e!==t.IMAGE_STATUS_LOADING&&e!==t.IMAGE_STATUS_LOADED){o[i]=t.IMAGE_STATUS_LOADING;var a=new window.Image;a.onload=function(){o[i]=t.IMAGE_STATUS_LOADED,r[i]=this,s.onload()},a.src=i}},t}();a.IMAGE_STATUS_LOADING=1,a.IMAGE_STATUS_LOADED=2;var n=window.devicePixelRatio||1,h=function(){function t(i){var e=i.start,o=i.end,r=i.from,a=i.to;s(this,t),this.start=e,this.end=o,this.from=r,this.to=a,this._isGradient=!0,this._gradient=null}return t.isGradient=function(t){return t&&t._isGradient},t.prototype.createGradient=function(t){return t.collectStats("createGradient"),this._gradient=t.ctx.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y),this._gradient.addColorStop(0,this.from),this._gradient.addColorStop(1,this.to),this._gradient},t.prototype.valueOf=function(){return this._gradient},t}(),c=function(){function t(i){var e=i.antialiasing,o=i.width,r=i.height;s(this,t),this.antialiasing=Boolean(e),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.scale({width:o||t.DEFAULT_WIDTH,height:r||t.DEFAULT_HEIGHT}),this.imageLoader=new a,this.imageLoader.onload=this.forceRedraw.bind(this),this.components=[],this.stats={createGradient:0,drawArc:0,drawCircle:0,drawImage:0,drawPolygon:0,drawPolyline:0,drawRect:0,drawText:0,measureText:0,stroke:0,fill:0},this._shouldRedraw=!1}return t.prototype.applyStyles=function(){this.ctx.canvas.style.width=this.width+"px",this.ctx.canvas.style.height=this.height+"px",this.ctx.canvas.style.position="absolute",this.ctx.canvas.style.top=0,this.ctx.canvas.style.left=0,this.ctx.canvas.style.right=0,this.ctx.canvas.style.bottom=0},t.prototype.scale=function(i){var e=i.width,s=i.height;this.width=e||t.DEFAULT_WIDTH,this.height=s||t.DEFAULT_HEIGHT,this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this.canvas.removeAttribute("style"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.applyStyles(),window.devicePixelRatio&&(this.ctx.canvas.width=this.width*n,this.ctx.canvas.height=this.height*n,this.ctx.scale(n,n)),this.antialiasing||this.ctx.translate(.5,.5),this.forceRedraw()},t.prototype.clear=function(){this.clearStats(),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},t.prototype.redraw=function(){for(var t=0;t<this.components.length;t++){var i=this.components[t];i.plot(this),i.draw(this)}this._shouldRedraw=!1},t.prototype.forceRedraw=function(){this._shouldRedraw=!0},t.prototype.shouldRedraw=function(){for(var t=0;t<this.components.length;t++){var i=this.components[t];if(i.shouldRedraw())return!0}return this._shouldRedraw},t.prototype.addComponent=function(t){var i=this.components.indexOf(t);if(i!==-1)throw new Error("component has already been added to layer");if("function"!=typeof t.plot||"function"!=typeof t.draw||"function"!=typeof t.shouldRedraw)throw new Error("component has not implemented Component interface");this.components.push(t),this.forceRedraw()},t.prototype.removeComponent=function(t){var i=this.components.indexOf(t);i!==-1&&(this.components.splice(i,1),this.forceRedraw())},t.prototype.createGradient=function(t){var i=t.start,e=t.end,s=t.from,o=t.to;return new h({start:i,end:e,from:s,to:o})},t.prototype.getColor=function(t){return h.isGradient(t)?t.createGradient(this):t},t.prototype.drawArc=function(t){var i=t.position,e=t.radius,s=t.startAngle,o=t.endAngle,r=t.color,a=t.width,n=void 0===a?1:a;this.collectStats("drawArc"),this.ctx.strokeStyle=this.getColor(r),this.ctx.lineWidth=n,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e,s,o),r&&(this.collectStats("stroke"),this.ctx.stroke())},t.prototype.drawCircle=function(t){var i=t.position,e=t.radius,s=t.color,o=t.fillColor,r=t.width,a=void 0===r?1:r;this.collectStats("drawCircle"),this.drawArc({position:i,radius:e,startAngle:0,endAngle:2*Math.PI,color:s,width:a}),o&&(this.collectStats("fill"),this.ctx.fillStyle=this.getColor(o),this.ctx.fill())},t.prototype.drawImage=function(t){var i=t.position,e=t.image,s=t.width,o=void 0===s?e.width:s,r=t.height,n=void 0===r?e.height:r,h=t.opacity,c=void 0===h?1:h;if(this.collectStats("drawImage"),"string"==typeof e){if(this.imageLoader.getStatus(e)!==a.IMAGE_STATUS_LOADED)return this.imageLoader.getStatus(e)!==a.IMAGE_STATUS_LOADING?void this.imageLoader.load(e):void 0;e=this.imageLoader.getImage(e),o=o||e.width,n=n||e.height}var l=this.ctx.globalAlpha;this.ctx.globalAlpha=c,this.antialiasing?this.ctx.drawImage(e,i.x,i.y,o,n):this.ctx.drawImage(e,i.x-.5,i.y-.5,o,n),this.ctx.globalAlpha=l},t.prototype.drawPolygon=function(t){var i=t.points,e=t.color,s=t.fillColor,o=t.width,r=void 0===o?1:o;this.collectStats("drawPolygon"),this.drawPolyline({points:i.concat(i[0]),color:e,width:r}),s&&(this.collectStats("fill"),this.ctx.fillStyle=this.getColor(s),this.ctx.fill())},t.prototype.drawPolyline=function(t){var i=t.points,e=t.color,s=t.lineDash,o=void 0===s?[]:s,r=t.width,a=void 0===r?1:r;this.collectStats("drawPolyline"),this.ctx.lineWidth=a,this.ctx.beginPath(),this.ctx.moveTo(i[0].x,i[0].y);for(var n,h=1;h<i.length;h++)n=i[h],this.ctx.lineTo(n.x,n.y);this.ctx.setLineDash(o),i[0].equals(i[i.length-1])&&this.ctx.closePath(),e&&(this.collectStats("stroke"),this.ctx.strokeStyle=this.getColor(e),this.ctx.stroke())},t.prototype.drawRect=function(t){var i=t.position,e=t.width,s=t.height,o=t.color,r=t.fillColor,a=t.strokeWidth,n=void 0===a?1:a;this.collectStats("drawRect"),this.ctx.lineWidth=n,this.ctx.beginPath(),this.antialiasing?this.ctx.rect(i.x,i.y,e,s):this.ctx.rect(i.x-.5,i.y-.5,e,s),this.ctx.closePath(),o&&(this.collectStats("stroke"),this.ctx.strokeStyle=this.getColor(o),this.ctx.stroke()),r&&(this.collectStats("fill"),this.ctx.fillStyle=this.getColor(r),this.ctx.fill())},t.prototype.drawText=function(t){var i=t.position,e=t.text,s=t.color,o=t.font,r=t.size,a=t.align,n=void 0===a?"center":a,h=t.baseline,c=void 0===h?"middle":h;this.collectStats("drawText"),this.ctx.fillStyle=this.getColor(s),this.ctx.font=r+"px "+o,this.ctx.textAlign=n,this.ctx.textBaseline=c,this.ctx.fillText(e,i.x,i.y)},t.prototype.measureText=function(t){var i=t.text,e=t.font,s=t.size;this.collectStats("measureText");var o;if(e&&s){var r=this.ctx.font;this.ctx.font=s+"px "+e,o=this.ctx.measureText(i).width,this.ctx.font=r}else o=this.ctx.measureText(i).width;return o},t.prototype.clearStats=function(){for(var t in this.stats)this.stats[t]=0},t.prototype.collectStats=function(t){this.stats[t]++},t.prototype.formatStats=function(){var t=[],e=20;for(var s in this.stats)t.push(s+i(this.stats[s],e-s.length));return t},t.prototype.drawStats=function(){},t}();c.DEFAULT_WIDTH=100,c.DEFAULT_HEIGHT=100;var l=function(){function t(){s(this,t)}return t.prototype.plot=function(t){},t.prototype.draw=function(t){},t.prototype.shouldRedraw=function(){return!1},t}(),d={RED:"#f44336",PINK:"#e91e63",PURPLE:"#9c27b0",DEEP_PURPLE:"#673ab7",INDIGO:"#3f51b5",BLUE:"#2196f3",LIGHT_BLUE:"#03a9f4",CYAN:"#00bcd4",TEAL:"#009688",GREEN:"#4caf50",LIGHT_GREEN:"#8bc34a",LIME:"#cddc39",YELLOW:"#ffeb3b",AMBER:"#ffc107",ORANGE:"#ff9800",DEEP_ORANGE:"#ff5722",BROWN:"#795548",GREY:"#9e9e9e",BLUE_GREY:"#607d8b"},f=function(){function t(i){var e=i.el;s(this,t),this.el=e,this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%",this.width=this.el.clientWidth,this.height=this.el.clientHeight,this.layers=[]}return t.spawn=function(i){var e=t.instances.indexOf(i);if(e!==-1)throw new Error("renderer has already been spawned");t.instances.push(i)},t.kill=function(i){var e=t.instances.indexOf(i);e!==-1&&t.instances.splice(e,1)},t.digest=function(){for(var i=0;i<t.instances.length;i++){var e=t.instances[i];e.clear(),e.scale(),e.redraw()}},t.prototype.addLayer=function(t){var i=this.layers.indexOf(t);if(i!==-1)throw new Error("layer has already been added to renderer");this.layers.push(t),this.el.appendChild(t.canvas),t.scale({width:this.width,height:this.height})},t.prototype.removeLayer=function(t){var i=this.layers.indexOf(t);i!==-1&&(this.layers.splice(i,1),this.el.removeChild(t.canvas))},t.prototype.scale=function(){var t=this.el.clientWidth,i=this.el.clientHeight;if(t!==this.width||i!==this.height){for(var e=0;e<this.layers.length;e++){var s=this.layers[e];s.scale({width:t,height:i})}this.width=t,this.height=i}},t.prototype.clear=function(){for(var t=0;t<this.layers.length;t++){var i=this.layers[t];i.shouldRedraw()&&i.clear()}},t.prototype.redraw=function(){for(var t=0;t<this.layers.length;t++){var i=this.layers[t];i.shouldRedraw()&&i.redraw()}},t}();return f.instances=[],f.CanvasLayer=c,f.Component=l,f.colors=d,f});
