!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Renderium=e()}(this,function(){"use strict";function t(t,e,i){if(t+="",(e-=t.length)<=0)return t;if(i||0===i||(i=" ")," "===(i+="")&&e<10)return o[e]+t;for(var n="";;){if(1&e&&(n+=i),!(e>>=1))break;i+=i}return n+t}function e(t){throw new Error("\r\nRenderium: "+t)}var i=t,o=[""," ","  ","   ","    ","     ","      ","       ","        ","         "],n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a={},h={},l=function(){function t(){n(this,t)}return t.prototype.onload=function(){},t.prototype.getImage=function(t){return h[t]},t.prototype.getStatus=function(t){return a[t]},t.prototype.load=function(e){var i=this,o=this.getStatus(e);if(o!==t.IMAGE_STATUS_LOADING&&o!==t.IMAGE_STATUS_LOADED){a[e]=t.IMAGE_STATUS_LOADING;var n=new window.Image;n.onload=function(){a[e]=t.IMAGE_STATUS_LOADED,h[e]=n,i.onload()},n.src=e}},t}();l.prototype.IMAGE_STATUS_LOADING=l.IMAGE_STATUS_LOADING=1,l.prototype.IMAGE_STATUS_LOADED=l.IMAGE_STATUS_LOADED=2;var c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),this.tasks=e}return t.prototype.plan=function(t){this.tasks[t]=!0},t.prototype.complete=function(t){this.tasks[t]=!1},t.prototype.should=function(t){return Boolean(this.tasks[t])},t}(),d=function(){function t(){n(this,t)}return t.isComponent=function(t){return"function"==typeof t.plot&&"function"==typeof t.draw&&"function"==typeof t.shouldRedraw&&"function"==typeof t.onadd&&"function"==typeof t.onremove},t.prototype.onadd=function(t){},t.prototype.onremove=function(t){},t.prototype.plot=function(t){},t.prototype.draw=function(t){},t.prototype.shouldRedraw=function(){return!0},t}(),p=function(){function t(e){var i=e.Vector,o=e.stats,s=e.width,r=e.height;n(this,t),this.Vector=i||window.Vector,this.width=Number(s)||t.DEFAULT_WIDTH,this.height=Number(r)||t.DEFAULT_HEIGHT,this.logStats=Boolean(o),this.canvas=document.createElement("canvas"),this.imageLoader=new l,this.scheduler=new c({redraw:!1,drawComponents:!1}),this.components=[],this.stats={}}return t.prototype.scale=function(i){var o=i.width,n=i.height;this.shouldDrawComponents()&&e("Layer#scale() is forbidden during render cycle"),this.width=Number(o)||t.DEFAULT_WIDTH,this.height=Number(n)||t.DEFAULT_HEIGHT,this.canvas.width=this.width,this.canvas.height=this.height,this.applyStyles(),this.planRedraw()},t.prototype.applyStyles=function(){this.shouldDrawComponents()&&e("Layer#applyStyles() is forbidden during render cycle"),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.canvas.style.right=0,this.canvas.style.bottom=0},t.prototype.clear=function(){this.shouldDrawComponents()&&e("Layer#clear() is forbidden during render cycle"),this.clearStats()},t.prototype.redraw=function(t){this.shouldDrawComponents()&&e("Layer#redraw() is forbidden during render cycle"),this.planDrawComponents();for(var i=0;i<this.components.length;i++){var o=this.components[i];(o.shouldRedraw()||this.scheduler.should("redraw"))&&o.plot(this,t),o.draw(this,t)}this.completeDrawComponents(),this.completeRedraw()},t.prototype.forceRedraw=function(){this.planRedraw()},t.prototype.planRedraw=function(){this.scheduler.plan("redraw")},t.prototype.completeRedraw=function(){this.scheduler.complete("redraw")},t.prototype.shouldRedraw=function(){for(var t=0;t<this.components.length;t++)if(this.components[t].shouldRedraw())return!0;return this.scheduler.should("redraw")},t.prototype.planDrawComponents=function(){this.scheduler.plan("drawComponents")},t.prototype.completeDrawComponents=function(){this.scheduler.complete("drawComponents")},t.prototype.shouldDrawComponents=function(){return this.scheduler.should("drawComponents")},t.prototype.addComponent=function(t){this.shouldDrawComponents()&&e("Layer#addComponent() is forbidden during render cycle"),-1!==this.components.indexOf(t)&&e("Component "+t.constructor.name+" has already been added to layer"),d.isComponent(t)||e("Component "+t.constructor.name+" has not implemented Component interface"),this.components.push(t),this.planRedraw(),t.onadd(this)},t.prototype.addComponents=function(t){t.forEach(this.addComponent,this)},t.prototype.removeComponent=function(t){this.shouldDrawComponents()&&e("Layer#removeComponent() is forbidden during render cycle");var i=this.components.indexOf(t);-1!==i&&(this.components.splice(i,1),this.planRedraw()),t.onremove(this)},t.prototype.removeComponents=function(t){t.forEach(this.removeComponent,this)},t.prototype.clearComponents=function(){this.shouldDrawComponents()&&e("Layer#clearComponents() is forbidden during render cycle"),this.components=[],this.planRedraw()},t.prototype.clearStats=function(){this.shouldDrawComponents()&&e("Layer#clearStats() is forbidden during render cycle");for(var t in this.stats)this.stats[t]=0},t.prototype.collectStats=function(t){this.stats[t]++},t.prototype.formatStats=function(){var t=[];for(var e in this.stats)t.push(e+i(this.stats[e],20-e.length));return t},t}();p.DEFAULT_WIDTH=100,p.DEFAULT_HEIGHT=100;var f=function(t,e){var i=t.length;if(i!==e.length)return!1;for(var o=0;o<i;o++)if(t[o]!==e[o])return!1;return!0},u=window.devicePixelRatio||1,y=function(t){function e(i){var o=i.Vector,s=i.stats,a=i.antialiasing,h=i.width,l=i.height;n(this,e);var c=r(this,t.call(this,{Vector:o,stats:s,width:h,height:l}));return c.antialiasing=Boolean(a),c.ctx=c.canvas.getContext("2d"),c.scale({width:h,height:l}),c.imageLoader.onload=c.planRedraw.bind(c),c.stats={stroke:0,fill:0},c.scheduler.complete("stroke"),c.scheduler.complete("fill"),c}return s(e,t),e.prototype.scale=function(e){var i=e.width,o=e.height;t.prototype.scale.call(this,{width:i,height:o}),window.devicePixelRatio&&(this.canvas.width=this.width*u,this.canvas.height=this.height*u,this.ctx.scale(u,u)),this.antialiasing||this.ctx.translate(.5,.5)},e.prototype.clear=function(){t.prototype.clear.call(this),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},e.prototype.redraw=function(e){t.prototype.redraw.call(this,e),this.performDraw(),this.logStats&&this.drawStats()},e.prototype.stateChanged=function(t){var e=t.color,i=t.fillColor,o=t.width,n=t.lineDash,s=t.opacity;return e&&e!==this.ctx.strokeStyle||i&&i!==this.ctx.fillStyle||o&&o!==this.ctx.lineWidth||s&&s!==this.ctx.globalAlpha||n&&!f(n,this.ctx.getLineDash())},e.prototype.performDraw=function(){this.scheduler.should("stroke")&&(this.ctx.stroke(),this.scheduler.complete("stroke"),this.collectStats("stroke")),this.scheduler.should("fill")&&(this.ctx.fill(),this.scheduler.complete("fill"),this.collectStats("fill")),this.ctx.beginPath()},e.prototype.createGradient=function(t){var e=t.start,i=t.end,o=t.from,n=t.to,s=this.ctx.createLinearGradient(e.x,e.y,i.x,i.y);return s.addColorStop(0,o),s.addColorStop(1,n),s},e.prototype.drawArc=function(t){var e=t.position,i=t.radius,o=t.startAngle,n=t.endAngle,s=t.color,r=t.width,a=void 0===r?1:r,h=t.opacity,l=void 0===h?1:h,c=t.lineDash,d=void 0===c?[]:c;this.stateChanged({color:s,width:a,opacity:l,lineDash:d})&&this.performDraw(),this.ctx.arc(e.x,e.y,i,o,n),s&&(this.ctx.strokeStyle=s,this.ctx.lineWidth=a,this.ctx.globalAlpha=l,this.ctx.setLineDash(d),this.scheduler.plan("stroke"))},e.prototype.drawCircle=function(t){var e=t.position,i=t.radius,o=t.color,n=t.fillColor,s=t.width,r=void 0===s?1:s,a=t.opacity,h=void 0===a?1:a,l=t.lineDash,c=void 0===l?[]:l;this.stateChanged({color:o,fillColor:n,width:r,opacity:h,lineDash:c})&&this.performDraw(),this.drawArc({position:e,radius:i,startAngle:0,endAngle:2*Math.PI,color:o,width:r,opacity:h,lineDash:c}),n&&(this.ctx.fillStyle=n,this.ctx.globalAlpha=h,this.scheduler.plan("fill"))},e.prototype.drawImage=function(t){var e=t.position,i=t.image,o=t.width,n=void 0===o?i.width:o,s=t.height,r=void 0===s?i.height:s,a=t.opacity,h=void 0===a?1:a;if(this.performDraw(),"string"==typeof i){if(this.imageLoader.getStatus(i)!==this.imageLoader.IMAGE_STATUS_LOADED)return this.imageLoader.getStatus(i)!==this.imageLoader.IMAGE_STATUS_LOADING?void this.imageLoader.load(i):void 0;i=this.imageLoader.getImage(i),n=n||i.width,r=r||i.height}this.ctx.globalAlpha=h,this.antialiasing?this.ctx.drawImage(i,e.x,e.y,n,r):this.ctx.drawImage(i,e.x-.5,e.y-.5,n,r)},e.prototype.drawPolygon=function(t){var e=t.points,i=t.color,o=t.fillColor,n=t.width,s=void 0===n?1:n,r=t.opacity,a=void 0===r?1:r,h=t.lineDash,l=void 0===h?[]:h;this.stateChanged({color:i,fillColor:o,width:s,opacity:a,lineDash:l})&&this.performDraw(),this.drawPolyline({points:e.concat(e[0]),color:i,width:s,opacity:a,lineDash:l}),o&&(this.ctx.fillStyle=o,this.ctx.globalAlpha=a,this.scheduler.plan("fill"))},e.prototype.drawPolyline=function(t){var e=t.points,i=t.color,o=t.width,n=void 0===o?1:o,s=t.opacity,r=void 0===s?1:s,a=t.lineDash,h=void 0===a?[]:a;this.stateChanged({color:i,width:n,opacity:r,lineDash:h})&&this.performDraw(),this.ctx.moveTo(e[0].x,e[0].y);for(var l,c=1;c<e.length;c++)l=e[c],this.ctx.lineTo(l.x,l.y);e[0].equals(e[e.length-1])&&this.ctx.closePath(),i&&(this.ctx.strokeStyle=i,this.ctx.lineWidth=n,this.ctx.globalAlpha=r,this.ctx.setLineDash(h),this.scheduler.plan("stroke"))},e.prototype.drawRect=function(t){var e=t.position,i=t.width,o=t.height,n=t.color,s=t.fillColor,r=t.strokeWidth,a=void 0===r?1:r,h=t.opacity,l=void 0===h?1:h,c=t.lineDash,d=void 0===c?[]:c;this.stateChanged({color:n,fillColor:s,width:a,opacity:l,lineDash:d})&&this.performDraw(),this.antialiasing?this.ctx.rect(e.x,e.y,i,o):this.ctx.rect(e.x-.5,e.y-.5,i,o),n&&(this.ctx.strokeStyle=n,this.ctx.lineWidth=a,this.ctx.globalAlpha=l,this.ctx.setLineDash(d),this.scheduler.plan("stroke")),s&&(this.ctx.globalAlpha=l,this.ctx.fillStyle=s,this.scheduler.plan("fill"))},e.prototype.drawText=function(t){var e=t.position,i=t.text,o=t.color,n=t.font,s=t.size,r=t.align,a=void 0===r?"center":r,h=t.baseline,l=void 0===h?"middle":h,c=t.opacity,d=void 0===c?1:c;this.performDraw(),this.ctx.fillStyle=o,this.ctx.font=s+"px "+n,this.ctx.textAlign=a,this.ctx.textBaseline=l,this.ctx.globalAlpha=d,this.ctx.fillText(i,e.x,e.y)},e.prototype.measureText=function(t){var e,i=t.text,o=t.font,n=t.size;if(o&&n){var s=this.ctx.font;this.ctx.font=n+"px "+o,e=this.ctx.measureText(i).width,this.ctx.font=s}else e=this.ctx.measureText(i).width;return e},e.prototype.drawStats=function(){for(var t=this.formatStats(),e=t.length;e--;)this.drawText({position:new this.Vector(this.width-10,this.height-14*(t.length-e)),text:t[e],color:"#fff",font:"Courier, monospace",size:14,align:"right",baleline:"bottom"})},e}(p),w=function(){function t(e){var i=e.start,o=e.end,s=e.from,r=e.to;n(this,t),this.start=i,this.end=o,this.from=s,this.to=r,this._isGradient=!0}return t.isGradient=function(t){return t&&t._isGradient},t}(),m={RED:"#f44336",PINK:"#e91e63",PURPLE:"#9c27b0",DEEP_PURPLE:"#673ab7",INDIGO:"#3f51b5",BLUE:"#2196f3",LIGHT_BLUE:"#03a9f4",CYAN:"#00bcd4",TEAL:"#009688",GREEN:"#4caf50",LIGHT_GREEN:"#8bc34a",LIME:"#cddc39",YELLOW:"#ffeb3b",AMBER:"#ffc107",ORANGE:"#ff9800",DEEP_ORANGE:"#ff5722",BROWN:"#795548",GREY:"#9e9e9e",BLUE_GREY:"#607d8b"},g=function(){function t(e){var i=e.el;n(this,t),this.el=i,this.applyStyles(),this.width=this.el.clientWidth,this.height=this.el.clientHeight,this.layers=[]}return t.spawn=function(i){-1!==t.instances.indexOf(i)&&e("Renderer has already been spawned"),t.instances.push(i)},t.kill=function(e){var i=t.instances.indexOf(e);-1!==i&&t.instances.splice(i,1)},t.digest=function(e){for(var i=0;i<t.instances.length;i++){var o=t.instances[i];o.scale(),o.clear(),o.redraw(e)}},t.prototype.applyStyles=function(){this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%"},t.prototype.addLayer=function(t){-1!==this.layers.indexOf(t)&&e("Layer has already been added to renderer"),this.layers.push(t),this.el.appendChild(t.canvas),t.scale({width:this.width,height:this.height})},t.prototype.removeLayer=function(t){var e=this.layers.indexOf(t);-1!==e&&(this.layers.splice(e,1),this.el.removeChild(t.canvas))},t.prototype.scale=function(){var t=this.el.clientWidth,e=this.el.clientHeight;if(t!==this.width||e!==this.height){for(var i=0;i<this.layers.length;i++)this.layers[i].scale({width:t,height:e});this.width=t,this.height=e}},t.prototype.clear=function(){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];e.shouldRedraw()&&e.clear()}},t.prototype.redraw=function(t){for(var e=0;e<this.layers.length;e++){var i=this.layers[e];i.shouldRedraw()&&i.redraw(t)}},t}();return g.instances=[],g.BaseLayer=p,g.CanvasLayer=y,g.LinearGradient=w,g.Component=d,g.colors=m,g});
