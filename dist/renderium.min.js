!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Renderium=i()}(this,function(){"use strict";var t=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},i={},e={},o=function(){function o(){t(this,o)}return o.prototype.onload=function(){},o.prototype.getImage=function(t){return e[t]},o.prototype.getStatus=function(t){return i[t]},o.prototype.load=function(t){var s=this.getStatus(t),n=this;if(s!==o.IMAGE_STATUS_LOADING&&s!==o.IMAGE_STATUS_LOADED){i[t]=o.IMAGE_STATUS_LOADING;var r=new window.Image;r.onload=function(){i[t]=o.IMAGE_STATUS_LOADED,e[t]=this,n.onload()},r.src=t}},o}();o.IMAGE_STATUS_LOADING=1,o.IMAGE_STATUS_LOADED=2;var s=window.devicePixelRatio||1,n=function(){function i(e){var o=e.start,s=e.end,n=e.from,r=e.to;t(this,i),this.start=o,this.end=s,this.from=n,this.to=r,this._isGradient=!0,this._gradient=null}return i.isGradient=function(t){return t&&t._isGradient},i.prototype.createGradient=function(t){return this._gradient=t.ctx.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y),this._gradient.addColorStop(0,this.from),this._gradient.addColorStop(1,this.to),this._gradient},i.prototype.valueOf=function(){return this._gradient},i}(),r=function(){function i(e){var s=e.antialiasing,n=e.width,r=e.height;t(this,i),this.antialiasing=Boolean(s),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.scale({width:n||i.DEFAULT_WIDTH,height:r||i.DEFAULT_HEIGHT}),this.imageLoader=new o,this.imageLoader.onload=this.forceRedraw.bind(this),this.components=[],this._shouldRedraw=!1}return i.prototype.applyStyles=function(){this.ctx.canvas.style.width=this.width+"px",this.ctx.canvas.style.height=this.height+"px",this.ctx.canvas.style.position="absolute",this.ctx.canvas.style.top=0,this.ctx.canvas.style.left=0,this.ctx.canvas.style.right=0,this.ctx.canvas.style.bottom=0},i.prototype.scale=function(t){var e=t.width,o=t.height;this.width=e||i.DEFAULT_WIDTH,this.height=o||i.DEFAULT_HEIGHT,this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this.canvas.removeAttribute("style"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.applyStyles(),window.devicePixelRatio&&(this.ctx.canvas.width=this.width*s,this.ctx.canvas.height=this.height*s,this.ctx.scale(s,s)),this.antialiasing||this.ctx.translate(.5,.5),this.forceRedraw()},i.prototype.clear=function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},i.prototype.redraw=function(){for(var t=0;t<this.components.length;t++){var i=this.components[t];i.plot(this),i.draw(this)}this._shouldRedraw=!1},i.prototype.forceRedraw=function(){this._shouldRedraw=!0},i.prototype.shouldRedraw=function(){for(var t=0;t<this.components.length;t++){var i=this.components[t];if(i.shouldRedraw())return!0}return this._shouldRedraw},i.prototype.addComponent=function(t){var i=this.components.indexOf(t);if(i!==-1)throw new Error("component has already been added to layer");if("function"!=typeof t.plot||"function"!=typeof t.draw||"function"!=typeof t.shouldRedraw)throw new Error("component has not implemented Component interface");this.components.push(t),this.forceRedraw()},i.prototype.removeComponent=function(t){var i=this.components.indexOf(t);i!==-1&&(this.components.splice(i,1),this.forceRedraw())},i.prototype.createGradient=function(t){var i=t.start,e=t.end,o=t.from,s=t.to;return new n({start:i,end:e,from:o,to:s})},i.prototype.getColor=function(t){return n.isGradient(t)?t.createGradient(this):t},i.prototype.drawArc=function(t){var i=t.position,e=t.radius,o=t.startAngle,s=t.endAngle,n=t.color,r=t.width,h=void 0===r?1:r;this.ctx.strokeStyle=this.getColor(n),this.ctx.lineWidth=h,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e,o,s),n&&this.ctx.stroke()},i.prototype.drawCircle=function(t){var i=t.position,e=t.radius,o=t.color,s=t.fillColor,n=t.width,r=void 0===n?1:n;this.drawArc({position:i,radius:e,startAngle:0,endAngle:2*Math.PI,color:o,width:r}),s&&(this.ctx.fillStyle=this.getColor(s),this.ctx.fill())},i.prototype.drawImage=function(t){var i=t.position,e=t.image,s=t.width,n=void 0===s?e.width:s,r=t.height,h=void 0===r?e.height:r,a=t.opacity,c=void 0===a?1:a;if("string"==typeof e){if(this.imageLoader.getStatus(e)!==o.IMAGE_STATUS_LOADED)return this.imageLoader.getStatus(e)!==o.IMAGE_STATUS_LOADING?void this.imageLoader.load(e):void 0;e=this.imageLoader.getImage(e),n=n||e.width,h=h||e.height}var l=this.ctx.globalAlpha;this.ctx.globalAlpha=c,this.antialiasing?this.ctx.drawImage(e,i.x,i.y,n,h):this.ctx.drawImage(e,i.x-.5,i.y-.5,n,h),this.ctx.globalAlpha=l},i.prototype.drawPolygon=function(t){var i=t.points,e=t.color,o=t.fillColor,s=t.width,n=void 0===s?1:s;this.drawPolyline({points:i.concat(i[0]),color:e,width:n}),o&&(this.ctx.fillStyle=this.getColor(o),this.ctx.fill())},i.prototype.drawPolyline=function(t){var i=t.points,e=t.color,o=t.lineDash,s=void 0===o?[]:o,n=t.width,r=void 0===n?1:n;this.ctx.lineWidth=r,this.ctx.beginPath(),this.ctx.moveTo(i[0].x,i[0].y);for(var h,a=1;a<i.length;a++)h=i[a],this.ctx.lineTo(h.x,h.y);this.ctx.setLineDash(s),i[0].equals(i[i.length-1])&&this.ctx.closePath(),e&&(this.ctx.strokeStyle=this.getColor(e),this.ctx.stroke())},i.prototype.drawRect=function(t){var i=t.position,e=t.width,o=t.height,s=t.color,n=t.fillColor,r=t.strokeWidth,h=void 0===r?1:r;this.ctx.lineWidth=h,this.ctx.beginPath(),this.antialiasing?this.ctx.rect(i.x,i.y,e,o):this.ctx.rect(i.x-.5,i.y-.5,e,o),this.ctx.closePath(),s&&(this.ctx.strokeStyle=this.getColor(s),this.ctx.stroke()),n&&(this.ctx.fillStyle=this.getColor(n),this.ctx.fill())},i.prototype.drawText=function(t){var i=t.position,e=t.text,o=t.color,s=t.font,n=t.size,r=t.align,h=void 0===r?"center":r,a=t.baseline,c=void 0===a?"middle":a;this.ctx.fillStyle=this.getColor(o),this.ctx.font=n+"px "+s,this.ctx.textAlign=h,this.ctx.textBaseline=c,this.ctx.fillText(e,i.x,i.y)},i.prototype.measureText=function(t){var i,e=t.text,o=t.font,s=t.size;if(o&&s){var n=this.ctx.font;this.ctx.font=s+"px "+o,i=this.ctx.measureText(e).width,this.ctx.font=n}else i=this.ctx.measureText(e).width;return i},i}();r.DEFAULT_WIDTH=100,r.DEFAULT_HEIGHT=100;var h=function(){function i(){t(this,i)}return i.prototype.plot=function(t){},i.prototype.draw=function(t){},i.prototype.shouldRedraw=function(){return!1},i}(),a={RED:"#f44336",PINK:"#e91e63",PURPLE:"#9c27b0",DEEP_PURPLE:"#673ab7",INDIGO:"#3f51b5",BLUE:"#2196f3",LIGHT_BLUE:"#03a9f4",CYAN:"#00bcd4",TEAL:"#009688",GREEN:"#4caf50",LIGHT_GREEN:"#8bc34a",LIME:"#cddc39",YELLOW:"#ffeb3b",AMBER:"#ffc107",ORANGE:"#ff9800",DEEP_ORANGE:"#ff5722",BROWN:"#795548",GREY:"#9e9e9e",BLUE_GREY:"#607d8b"},c=function(){function i(e){var o=e.el;t(this,i),this.el=o,this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%",this.width=this.el.clientWidth,this.height=this.el.clientHeight,this.layers=[]}return i.spawn=function(t){var e=i.instances.indexOf(t);if(e!==-1)throw new Error("renderer has already been spawned");i.instances.push(t)},i.kill=function(t){var e=i.instances.indexOf(t);e!==-1&&i.instances.splice(e,1)},i.digest=function(){for(var t=0;t<i.instances.length;t++){var e=i.instances[t];e.clear(),e.scale(),e.redraw()}},i.prototype.addLayer=function(t){var i=this.layers.indexOf(t);if(i!==-1)throw new Error("layer has already been added to renderer");this.layers.push(t),this.el.appendChild(t.canvas),t.scale({width:this.width,height:this.height})},i.prototype.removeLayer=function(t){var i=this.layers.indexOf(t);i!==-1&&(this.layers.splice(i,1),this.el.removeChild(t.canvas))},i.prototype.scale=function(){var t=this.el.clientWidth,i=this.el.clientHeight;if(t!==this.width||i!==this.height){for(var e=0;e<this.layers.length;e++){var o=this.layers[e];o.scale({width:t,height:i})}this.width=t,this.height=i}},i.prototype.clear=function(){for(var t=0;t<this.layers.length;t++){var i=this.layers[t];i.shouldRedraw()&&i.clear()}},i.prototype.redraw=function(){for(var t=0;t<this.layers.length;t++){var i=this.layers[t];i.shouldRedraw()&&i.redraw()}},i}();return c.instances=[],c.CanvasLayer=r,c.Component=h,c.colors=a,c});
