!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Renderium=e()}(this,function(){"use strict";function t(t){throw new Error("\r\nRenderium: "+t)}var e=function(t,e,o){if(t+="",(e-=t.length)<=0)return t;if(o||0===o||(o=" ")," "==(o+="")&&e<10)return i[e]+t;for(var s="";1&e&&(s+=o),e>>=1;)o+=o;return s+t},i=[""," ","  ","   ","    ","     ","      ","       ","        ","         "],o={},s={},r=function(){};r.prototype.onload=function(){},r.prototype.getImage=function(t){return s[t]},r.prototype.getStatus=function(t){return o[t]},r.prototype.load=function(t){var e=this,i=this.getStatus(t);if(i!==r.IMAGE_STATUS_LOADING&&i!==r.IMAGE_STATUS_LOADED){o[t]=r.IMAGE_STATUS_LOADING;var n=new window.Image;n.onload=function(){o[t]=r.IMAGE_STATUS_LOADED,s[t]=n,e.onload()},n.src=t}},r.prototype.IMAGE_STATUS_LOADING=r.IMAGE_STATUS_LOADING=1,r.prototype.IMAGE_STATUS_LOADED=r.IMAGE_STATUS_LOADED=2;var n=function(t){void 0===t&&(t={}),this.tasks=t};n.prototype.plan=function(t){this.tasks[t]=!0},n.prototype.complete=function(t){this.tasks[t]=!1},n.prototype.should=function(t){return Boolean(this.tasks[t])};var a=function(){};a.isComponent=function(t){return"function"==typeof t.plot&&"function"==typeof t.draw&&"function"==typeof t.shouldRedraw&&"function"==typeof t.onadd&&"function"==typeof t.onremove},a.prototype.onadd=function(t){},a.prototype.onremove=function(t){},a.prototype.plot=function(t){},a.prototype.draw=function(t){},a.prototype.shouldRedraw=function(){return!0};var h=function t(e){var i=e.Vector,o=e.stats,s=e.width,a=e.height;this.Vector=i||window.Vector,this.width=Number(s)||t.DEFAULT_WIDTH,this.height=Number(a)||t.DEFAULT_HEIGHT,this.logStats=Boolean(o),this.canvas=document.createElement("canvas"),this.imageLoader=new r,this.scheduler=new n({redraw:!1,drawComponents:!1}),this.components=[],this.stats={}};h.prototype.scale=function(e){var i=e.width,o=e.height;this.shouldDrawComponents()&&t("Layer#scale() is forbidden during render cycle"),this.width=Number(i)||h.DEFAULT_WIDTH,this.height=Number(o)||h.DEFAULT_HEIGHT,this.canvas.width=this.width,this.canvas.height=this.height,this.applyStyles(),this.planRedraw()},h.prototype.applyStyles=function(){this.shouldDrawComponents()&&t("Layer#applyStyles() is forbidden during render cycle"),this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.canvas.style.right=0,this.canvas.style.bottom=0},h.prototype.clear=function(){this.shouldDrawComponents()&&t("Layer#clear() is forbidden during render cycle"),this.clearStats()},h.prototype.redraw=function(e){var i=this;this.shouldDrawComponents()&&t("Layer#redraw() is forbidden during render cycle"),this.planDrawComponents();for(var o=0;o<this.components.length;o++){var s=i.components[o];(s.shouldRedraw()||i.scheduler.should("redraw"))&&s.plot(i,e),s.draw(i,e)}this.completeDrawComponents(),this.completeRedraw()},h.prototype.forceRedraw=function(){this.planRedraw()},h.prototype.planRedraw=function(){this.scheduler.plan("redraw")},h.prototype.completeRedraw=function(){this.scheduler.complete("redraw")},h.prototype.shouldRedraw=function(){for(var t=this,e=0;e<this.components.length;e++)if(t.components[e].shouldRedraw())return!0;return this.scheduler.should("redraw")},h.prototype.planDrawComponents=function(){this.scheduler.plan("drawComponents")},h.prototype.completeDrawComponents=function(){this.scheduler.complete("drawComponents")},h.prototype.shouldDrawComponents=function(){return this.scheduler.should("drawComponents")},h.prototype.addComponent=function(e){this.shouldDrawComponents()&&t("Layer#addComponent() is forbidden during render cycle"),-1!==this.components.indexOf(e)&&t("Component "+e.constructor.name+" has already been added to layer"),a.isComponent(e)||t("Component "+e.constructor.name+" has not implemented Component interface"),this.components.push(e),this.planRedraw(),e.onadd(this)},h.prototype.addComponents=function(t){t.forEach(this.addComponent,this)},h.prototype.removeComponent=function(e){this.shouldDrawComponents()&&t("Layer#removeComponent() is forbidden during render cycle");var i=this.components.indexOf(e);-1!==i&&(this.components.splice(i,1),this.planRedraw()),e.onremove(this)},h.prototype.removeComponents=function(t){t.forEach(this.removeComponent,this)},h.prototype.clearComponents=function(){this.shouldDrawComponents()&&t("Layer#clearComponents() is forbidden during render cycle"),this.components=[],this.planRedraw()},h.prototype.clearStats=function(){var e=this;this.shouldDrawComponents()&&t("Layer#clearStats() is forbidden during render cycle");for(var i in e.stats)e.stats[i]=0},h.prototype.collectStats=function(t){this.stats[t]++},h.prototype.formatStats=function(){var t=this,i=[];for(var o in t.stats)i.push(o+e(t.stats[o],20-o.length));return i},h.DEFAULT_WIDTH=100,h.DEFAULT_HEIGHT=100;var l=function(t,e){var i=t.length;if(i!==e.length)return!1;for(var o=0;o<i;o++)if(t[o]!==e[o])return!1;return!0},c=window.devicePixelRatio||1,d=function(t){function e(e){var i=e.Vector,o=e.stats,s=e.antialiasing,r=e.width,n=e.height;t.call(this,{Vector:i,stats:o,width:r,height:n}),this.antialiasing=Boolean(s),this.ctx=this.canvas.getContext("2d"),this.scale({width:r,height:n}),this.imageLoader.onload=this.planRedraw.bind(this),this.stats={stroke:0,fill:0},this.scheduler.complete("stroke"),this.scheduler.complete("fill")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.scale=function(e){var i=e.width,o=e.height;t.prototype.scale.call(this,{width:i,height:o}),window.devicePixelRatio&&(this.canvas.width=this.width*c,this.canvas.height=this.height*c,this.ctx.scale(c,c)),this.antialiasing||this.ctx.translate(.5,.5)},e.prototype.clear=function(){t.prototype.clear.call(this),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},e.prototype.redraw=function(e){t.prototype.redraw.call(this,e),this.performDraw(),this.logStats&&this.drawStats()},e.prototype.stateChanged=function(t){var e=t.color,i=t.fillColor,o=t.width,s=t.lineDash,r=t.opacity;return e&&e!==this.ctx.strokeStyle||i&&i!==this.ctx.fillStyle||o&&o!==this.ctx.lineWidth||r&&r!==this.ctx.globalAlpha||s&&!l(s,this.ctx.getLineDash())},e.prototype.performDraw=function(){this.scheduler.should("stroke")&&(this.ctx.stroke(),this.scheduler.complete("stroke"),this.collectStats("stroke")),this.scheduler.should("fill")&&(this.ctx.fill(),this.scheduler.complete("fill"),this.collectStats("fill")),this.ctx.beginPath()},e.prototype.createGradient=function(t){var e=t.start,i=t.end,o=t.from,s=t.to,r=this.ctx.createLinearGradient(e.x,e.y,i.x,i.y);return r.addColorStop(0,o),r.addColorStop(1,s),r},e.prototype.drawArc=function(t){var e=t.position,i=t.radius,o=t.startAngle,s=t.endAngle,r=t.color,n=t.width;void 0===n&&(n=1);var a=t.opacity;void 0===a&&(a=1);var h=t.lineDash;void 0===h&&(h=[]),this.stateChanged({color:r,width:n,opacity:a,lineDash:h})&&this.performDraw(),this.ctx.arc(e.x,e.y,i,o,s),r&&(this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.globalAlpha=a,this.ctx.setLineDash(h),this.scheduler.plan("stroke"))},e.prototype.drawCircle=function(t){var e=t.position,i=t.radius,o=t.color,s=t.fillColor,r=t.width;void 0===r&&(r=1);var n=t.opacity;void 0===n&&(n=1);var a=t.lineDash;void 0===a&&(a=[]),this.stateChanged({color:o,fillColor:s,width:r,opacity:n,lineDash:a})&&this.performDraw(),this.drawArc({position:e,radius:i,startAngle:0,endAngle:2*Math.PI,color:o,width:r,opacity:n,lineDash:a}),s&&(this.ctx.fillStyle=s,this.ctx.globalAlpha=n,this.scheduler.plan("fill"))},e.prototype.drawImage=function(t){var e=t.position,i=t.image,o=t.width;void 0===o&&(o=i.width);var s=t.height;void 0===s&&(s=i.height);var r=t.opacity;if(void 0===r&&(r=1),this.performDraw(),"string"==typeof i){if(this.imageLoader.getStatus(i)!==this.imageLoader.IMAGE_STATUS_LOADED)return this.imageLoader.getStatus(i)!==this.imageLoader.IMAGE_STATUS_LOADING?void this.imageLoader.load(i):void 0;i=this.imageLoader.getImage(i),o=o||i.width,s=s||i.height}this.ctx.globalAlpha=r,this.antialiasing?this.ctx.drawImage(i,e.x,e.y,o,s):this.ctx.drawImage(i,e.x-.5,e.y-.5,o,s)},e.prototype.drawPolygon=function(t){var e=t.points,i=t.color,o=t.fillColor,s=t.width;void 0===s&&(s=1);var r=t.opacity;void 0===r&&(r=1);var n=t.lineDash;void 0===n&&(n=[]),this.stateChanged({color:i,fillColor:o,width:s,opacity:r,lineDash:n})&&this.performDraw(),this.drawPolyline({points:e.concat(e[0]),color:i,width:s,opacity:r,lineDash:n}),o&&(this.ctx.fillStyle=o,this.ctx.globalAlpha=r,this.scheduler.plan("fill"))},e.prototype.drawPolyline=function(t){var e=this,i=t.points,o=t.color,s=t.width;void 0===s&&(s=1);var r=t.opacity;void 0===r&&(r=1);var n=t.lineDash;void 0===n&&(n=[]),this.stateChanged({color:o,width:s,opacity:r,lineDash:n})&&this.performDraw(),this.ctx.moveTo(i[0].x,i[0].y);for(var a,h=1;h<i.length;h++)a=i[h],e.ctx.lineTo(a.x,a.y);i[0].equals(i[i.length-1])&&this.ctx.closePath(),o&&(this.ctx.strokeStyle=o,this.ctx.lineWidth=s,this.ctx.globalAlpha=r,this.ctx.setLineDash(n),this.scheduler.plan("stroke"))},e.prototype.drawRect=function(t){var e=t.position,i=t.width,o=t.height,s=t.color,r=t.fillColor,n=t.strokeWidth;void 0===n&&(n=1);var a=t.opacity;void 0===a&&(a=1);var h=t.lineDash;void 0===h&&(h=[]),this.stateChanged({color:s,fillColor:r,width:n,opacity:a,lineDash:h})&&this.performDraw(),this.antialiasing?this.ctx.rect(e.x,e.y,i,o):this.ctx.rect(e.x-.5,e.y-.5,i,o),s&&(this.ctx.strokeStyle=s,this.ctx.lineWidth=n,this.ctx.globalAlpha=a,this.ctx.setLineDash(h),this.scheduler.plan("stroke")),r&&(this.ctx.globalAlpha=a,this.ctx.fillStyle=r,this.scheduler.plan("fill"))},e.prototype.drawText=function(t){var e=t.position,i=t.text,o=t.color,s=t.font,r=t.size,n=t.align;void 0===n&&(n="center");var a=t.baseline;void 0===a&&(a="middle");var h=t.opacity;void 0===h&&(h=1),this.performDraw(),this.ctx.fillStyle=o,this.ctx.font=r+"px "+s,this.ctx.textAlign=n,this.ctx.textBaseline=a,this.ctx.globalAlpha=h,this.ctx.fillText(i,e.x,e.y)},e.prototype.measureText=function(t){var e,i=t.text,o=t.font,s=t.size;if(o&&s){var r=this.ctx.font;this.ctx.font=s+"px "+o,e=this.ctx.measureText(i).width,this.ctx.font=r}else e=this.ctx.measureText(i).width;return e},e.prototype.drawStats=function(){for(var t=this,e=this.formatStats(),i=e.length;i--;)t.drawText({position:new t.Vector(t.width-10,t.height-14*(e.length-i)),text:e[i],color:"#fff",font:"Courier, monospace",size:14,align:"right",baleline:"bottom"})},e}(h),p=function(t){var e=t.start,i=t.end,o=t.from,s=t.to;this.start=e,this.end=i,this.from=o,this.to=s,this._isGradient=!0};p.isGradient=function(t){return t&&t._isGradient};var f={RED:"#f44336",PINK:"#e91e63",PURPLE:"#9c27b0",DEEP_PURPLE:"#673ab7",INDIGO:"#3f51b5",BLUE:"#2196f3",LIGHT_BLUE:"#03a9f4",CYAN:"#00bcd4",TEAL:"#009688",GREEN:"#4caf50",LIGHT_GREEN:"#8bc34a",LIME:"#cddc39",YELLOW:"#ffeb3b",AMBER:"#ffc107",ORANGE:"#ff9800",DEEP_ORANGE:"#ff5722",BROWN:"#795548",GREY:"#9e9e9e",BLUE_GREY:"#607d8b"},u=function(t){var e=t.el;this.el=e,this.applyStyles(),this.width=this.el.clientWidth,this.height=this.el.clientHeight,this.layers=[]};return u.spawn=function(e){-1!==u.instances.indexOf(e)&&t("Renderer has already been spawned"),u.instances.push(e)},u.kill=function(t){var e=u.instances.indexOf(t);-1!==e&&u.instances.splice(e,1)},u.digest=function(t){for(var e=0;e<u.instances.length;e++){var i=u.instances[e];i.scale(),i.clear(),i.redraw(t)}},u.prototype.applyStyles=function(){this.el.style.position="relative",this.el.style.width="100%",this.el.style.height="100%"},u.prototype.addLayer=function(e){-1!==this.layers.indexOf(e)&&t("Layer has already been added to renderer"),this.layers.push(e),this.el.appendChild(e.canvas),e.scale({width:this.width,height:this.height})},u.prototype.removeLayer=function(t){var e=this.layers.indexOf(t);-1!==e&&(this.layers.splice(e,1),this.el.removeChild(t.canvas))},u.prototype.scale=function(){var t=this,e=this.el.clientWidth,i=this.el.clientHeight;if(e!==this.width||i!==this.height){for(var o=0;o<this.layers.length;o++)t.layers[o].scale({width:e,height:i});this.width=e,this.height=i}},u.prototype.clear=function(){for(var t=this,e=0;e<this.layers.length;e++){var i=t.layers[e];i.shouldRedraw()&&i.clear()}},u.prototype.redraw=function(t){for(var e=this,i=0;i<this.layers.length;i++){var o=e.layers[i];o.shouldRedraw()&&o.redraw(t)}},u.instances=[],u.BaseLayer=h,u.CanvasLayer=d,u.LinearGradient=p,u.Component=a,u.colors=f,u});
